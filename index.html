<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SpellRightPro</title>
<style>
  :root {
    --bg-light: #f9f9f9;
    --bg-dark: #121212;
    --text-light: #222;
    --text-dark: #eee;
    --primary-color: #0078d7;
    --accent-color: #ff6600;
    --border-color: #ccc;
    --font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  }
  body {
    font-family: var(--font-family);
    margin: 0; padding: 0;
    background-color: var(--bg-light);
    color: var(--text-light);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark {
    background-color: var(--bg-dark);
    color: var(--text-dark);
  }
  header {
    width: 100%;
    max-width: 600px;
    text-align: center;
    margin-bottom: 1rem;
  }
  header h1 {
    margin: 0 0 0.25rem 0;
  }
  header small {
    color: var(--accent-color);
  }
  main {
    width: 100%;
    max-width: 600px;
    background: #fff;
    border-radius: 8px;
    padding: 1rem 1.5rem;
    box-shadow: 0 4px 12px rgb(0 0 0 / 0.1);
    transition: background 0.3s, color 0.3s;
  }
  body.dark main {
    background: #1e1e1e;
  }
  label {
    display: block;
    margin-top: 1rem;
    font-weight: 600;
  }
  select, input[type="text"], textarea, button {
    width: 100%;
    font-size: 1rem;
    padding: 0.5rem 0.75rem;
    margin-top: 0.25rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    box-sizing: border-box;
  }
  body.dark select, 
  body.dark input[type="text"],
  body.dark textarea {
    background: #333;
    border-color: #555;
    color: var(--text-dark);
  }
  button {
    cursor: pointer;
    background: var(--primary-color);
    color: #fff;
    border: none;
    margin-top: 1rem;
    font-weight: 700;
    transition: background 0.2s ease;
  }
  button:hover, button:focus {
    background: #005fa3;
  }
  .controls {
    display: flex;
    justify-content: space-between;
    margin-top: 1rem;
  }
  .controls button {
    width: 48%;
  }
  .word-box {
    font-size: 2.25rem;
    font-weight: 700;
    margin: 1.25rem 0;
    text-align: center;
    user-select: none;
    min-height: 3rem;
  }
  .feedback {
    text-align: center;
    font-weight: 600;
    margin-top: 0.75rem;
    height: 1.5rem;
  }
  .hidden {
    display: none !important;
  }
  #spellingbee-controls {
    margin-top: 1rem;
    text-align: center;
  }
  #login-section {
    text-align: center;
    margin-bottom: 1rem;
  }
  #login-section input {
    max-width: 200px;
    margin: 0 auto;
  }
  .toggle-switch {
    display: inline-block;
    position: relative;
    width: 52px;
    height: 28px;
    margin-left: 0.5rem;
    vertical-align: middle;
  }
  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .slider {
    position: absolute;
    cursor: pointer;
    background-color: #ccc;
    border-radius: 28px;
    top: 0; left: 0; right: 0; bottom: 0;
    transition: .4s;
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    border-radius: 50%;
    transition: .4s;
  }
  input:checked + .slider {
    background-color: var(--primary-color);
  }
  input:checked + .slider:before {
    transform: translateX(24px);
  }
  /* Responsive */
  @media (max-width: 480px) {
    main {
      padding: 1rem;
    }
  }
</style>
</head>
<body>
<header>
  <h1>SpellRightPro <small>‚Äì Practice & Spelling Bee</small></h1>
</header>

<main>
  <section id="login-section">
    <label for="username-input">Enter your username to start:</label>
    <input type="text" id="username-input" placeholder="Your name" />
    <button id="login-btn">Login</button>
    <p id="welcome-msg" class="hidden">Welcome, <span id="username-display"></span>!</p>
  </section>

  <label for="mode-select">Select Mode / Exam:</label>
  <select id="mode-select" aria-label="Select exam or mode">
    <option value="oet">OET (Write what you hear)</option>
    <option value="spellingbee">Spelling Bee (Spell verbally)</option>
  </select>

  <label for="custom-words">Custom Words (comma, space, slash, or newline separated):</label>
  <textarea id="custom-words" rows="4" placeholder="Enter custom words here..."></textarea>

  <button id="load-words-btn">Load Words</button>

  <div class="word-box" id="word-display" aria-live="polite" aria-atomic="true" tabindex="0">‚Äî</div>

  <!-- OET input -->
  <div id="oet-input-container" class="hidden">
    <label for="oet-answer-input">Type what you heard:</label>
    <input type="text" id="oet-answer-input" autocomplete="off" />
    <button id="check-oet-answer-btn">Check Answer</button>
    <div class="feedback" id="oet-feedback" aria-live="assertive"></div>
  </div>

  <!-- Spelling Bee controls -->
  <div id="spellingbee-controls" class="hidden">
    <button id="speak-word-btn">üîä Hear Word</button>
    <button id="start-spell-btn">üé§ Start Spelling (Microphone)</button>
    <button id="stop-spell-btn" disabled>‚èπ Stop Spelling</button>
    <div class="feedback" id="spellingbee-feedback" aria-live="assertive"></div>
  </div>

  <div class="controls">
    <button id="prev-word-btn">‚Üê Previous</button>
    <button id="next-word-btn">Next ‚Üí</button>
  </div>

  <label for="darkmode-toggle">Dark Mode
    <span class="toggle-switch">
      <input type="checkbox" id="darkmode-toggle" />
      <span class="slider"></span>
    </span>
  </label>
</main>

<script>
(() => {
  "use strict";

  // Sample word lists:
  const oetSampleWords = [
    "hospital", "patient", "medicine", "appointment", "nurse",
    "diagnosis", "treatment", "symptom", "prescription", "recovery"
  ];

  const spellingBeeSampleWords = [
    "accommodation", "embarrassment", "pronunciation", "rhythm",
    "knowledge", "conscience", "separate", "occasionally", "supersede", "bureaucracy"
  ];

  // State
  let currentUser = null;
  let words = [];
  let currentIndex = 0;
  let currentMode = "oet"; // oet or spellingbee
  let recognition = null;
  let recognizing = false;

  // Elements
  const usernameInput = document.getElementById("username-input");
  const loginBtn = document.getElementById("login-btn");
  const welcomeMsg = document.getElementById("welcome-msg");
  const usernameDisplay = document.getElementById("username-display");

  const modeSelect = document.getElementById("mode-select");
  const customWordsTextarea = document.getElementById("custom-words");
  const loadWordsBtn = document.getElementById("load-words-btn");

  const wordDisplay = document.getElementById("word-display");

  const oetInputContainer = document.getElementById("oet-input-container");
  const oetAnswerInput = document.getElementById("oet-answer-input");
  const checkOetAnswerBtn = document.getElementById("check-oet-answer-btn");
  const oetFeedback = document.getElementById("oet-feedback");

  const spellingbeeControls = document.getElementById("spellingbee-controls");
  const speakWordBtn = document.getElementById("speak-word-btn");
  const startSpellBtn = document.getElementById("start-spell-btn");
  const stopSpellBtn = document.getElementById("stop-spell-btn");
  const spellingbeeFeedback = document.getElementById("spellingbee-feedback");

  const prevWordBtn = document.getElementById("prev-word-btn");
  const nextWordBtn = document.getElementById("next-word-btn");

  const darkModeToggle = document.getElementById("darkmode-toggle");

  // --- Functions ---

  function setDarkMode(enabled) {
    if (enabled) {
      document.body.classList.add("dark");
      darkModeToggle.checked = true;
      localStorage.setItem("spellrightpro-darkmode", "true");
    } else {
      document.body.classList.remove("dark");
      darkModeToggle.checked = false;
      localStorage.removeItem("spellrightpro-darkmode");
    }
  }

  function loadWordsFromText(text) {
    // Split by commas, slashes, spaces, newlines; remove empty; trim; lowercase
    const rawWords = text.split(/[\s,\/]+/);
    const filtered = rawWords
      .map(w => w.trim())
      .filter(w => w.length > 0);
    return filtered;
  }

  function loadWords() {
    // If custom words textarea has text, use that.
    const customText = customWordsTextarea.value.trim();
    if (customText.length > 0) {
      words = loadWordsFromText(customText);
    } else {
      // Load defaults based on mode
      if (currentMode === "oet") {
        words = [...oetSampleWords];
      } else if (currentMode === "spellingbee") {
        words = [...spellingBeeSampleWords];
      } else {
        words = [];
      }
    }
    currentIndex = 0;
    oetAnswerInput.value = "";
    oetFeedback.textContent = "";
    spellingbeeFeedback.textContent = "";
    updateUI();
  }

  function updateUI() {
    if (words.length === 0) {
      wordDisplay.textContent = "‚Äî";
      oetAnswerInput.disabled = true;
      checkOetAnswerBtn.disabled = true;
      speakWordBtn.disabled = true;
      startSpellBtn.disabled = true;
      stopSpellBtn.disabled = true;
      return;
    }
    // Show current word (in spellingbee, the word is hidden and read aloud)
    if (currentMode === "oet") {
      wordDisplay.textContent = words[currentIndex];
      oetAnswerInput.disabled = false;
      checkOetAnswerBtn.disabled = false;
      oetAnswerInput.value = "";
      oetAnswerInput.focus();
      speakWordBtn.disabled = true;
      startSpellBtn.disabled = true;
      stopSpellBtn.disabled = true;
    } else if (currentMode === "spellingbee") {
      wordDisplay.textContent = "üîí Listen and spell verbally";
      oetAnswerInput.disabled = true;
      checkOetAnswerBtn.disabled = true;
      speakWordBtn.disabled = false;
      startSpellBtn.disabled = false;
      stopSpellBtn.disabled = true;
      spellingbeeFeedback.textContent = "";
    }
  }

  function speak(text) {
    if (!("speechSynthesis" in window)) {
      alert("Sorry, your browser does not support Speech Synthesis.");
      return;
    }
    window.speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(text);
    // Prefer British English voice if available
    const voices = window.speechSynthesis.getVoices();
    let selectedVoice = null;
    for (const voice of voices) {
      if (voice.lang.startsWith("en-GB")) {
        selectedVoice = voice;
        break;
      }
    }
    if (selectedVoice) {
      utterance.voice = selectedVoice;
    }
    utterance.rate = 0.9;
    window.speechSynthesis.speak(utterance);
  }

  function showFeedback(element, message, success = true) {
    element.textContent = message;
    element.style.color = success ? "green" : "crimson";
  }

  function checkOetAnswer() {
    const answer = oetAnswerInput.value.trim().toLowerCase();
    const correct = words[currentIndex].toLowerCase();
    if (!answer) {
      showFeedback(oetFeedback, "Please type your answer.", false);
      return;
    }
    if (answer === correct) {
      showFeedback(oetFeedback, "Correct! üéâ", true);
    } else {
      showFeedback(oetFeedback, `Incorrect. Correct word is: "${correct}"`, false);
    }
  }

  function moveNext() {
    if (words.length === 0) return;
    currentIndex = (currentIndex + 1) % words.length;
    oetFeedback.textContent = "";
    spellingbeeFeedback.textContent = "";
    oetAnswerInput.value = "";
    updateUI();
  }

  function movePrev() {
    if (words.length === 0) return;
    currentIndex = (currentIndex - 1 + words.length) % words.length;
    oetFeedback.textContent = "";
    spellingbeeFeedback.textContent = "";
    oetAnswerInput.value = "";
    updateUI();
  }

  // Spelling Bee microphone voice recognition
  function initRecognition() {
    if (!("webkitSpeechRecognition" in window || "SpeechRecognition" in window)) {
      spellingbeeFeedback.textContent = "Speech Recognition not supported in this browser.";
      startSpellBtn.disabled = true;
      return null;
    }
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recog = new SpeechRecognition();
    recog.lang = "en-GB";
    recog.interimResults = false;
    recog.maxAlternatives = 1;
    recog.continuous = false;
    return recog;
  }

  function startRecognition() {
    if (!recognition) return;
    if (recognizing) return;
    spellingbeeFeedback.textContent = "Listening... Spell the word letter by letter.";
    recognition.start();
    recognizing = true;
    startSpellBtn.disabled = true;
    stopSpellBtn.disabled = false;
  }

  function stopRecognition() {
    if (!recognition) return;
    if (!recognizing) return;
    recognition.stop();
    recognizing = false;
    startSpellBtn.disabled = false;
    stopSpellBtn.disabled = true;
  }

  function normalizeSpelling(input) {
    // Remove spaces, say user might say "a c c o m m o d a t i o n"
    // Remove spaces, dashes, convert to lowercase
    return input.toLowerCase().replace(/[^a-z]/g, "");
  }

  function processSpellingResult(spoken) {
    const expected = normalizeSpelling(words[currentIndex]);
    const given = normalizeSpelling(spoken);

    if (given === expected) {
      showFeedback(spellingbeeFeedback, "Correct! üéâ", true);
      moveNext();
    } else {
      showFeedback(spellingbeeFeedback, `Incorrect. You said: "${spoken}". Try again.`, false);
    }
  }

  // --- Event Listeners ---

  loginBtn.addEventListener("click", () => {
    const val = usernameInput.value.trim();
    if (val.length < 2) {
      alert("Please enter a valid username (at least 2 characters).");
      return;
    }
    currentUser = val;
    usernameDisplay.textContent = currentUser;
    welcomeMsg.classList.remove("hidden");
    loginBtn.disabled = true;
    usernameInput.disabled = true;
  });

  modeSelect.addEventListener("change", () => {
    currentMode = modeSelect.value;
    oetInputContainer.classList.toggle("hidden", currentMode !== "oet");
    spellingbeeControls.classList.toggle("hidden", currentMode !== "spellingbee");
    loadWords();
  });

  loadWordsBtn.addEventListener("click", () => {
    loadWords();
  });

  checkOetAnswerBtn.addEventListener("click", () => {
    checkOetAnswer();
  });

  prevWordBtn.addEventListener("click", () => {
    movePrev();
  });

  nextWordBtn.addEventListener("click", () => {
    moveNext();
  });

  speakWordBtn.addEventListener("click", () => {
    if (words.length === 0) return;
    speak(words[currentIndex]);
  });

  startSpellBtn.addEventListener("click", () => {
    startRecognition();
  });

  stopSpellBtn.addEventListener("click", () => {
    stopRecognition();
  });

  darkModeToggle.addEventListener("change", () => {
    setDarkMode(darkModeToggle.checked);
  });

  // Recognition setup
  recognition = initRecognition();
  if (recognition) {
    recognition.addEventListener("result", (event) => {
      const transcript = event.results[0][0].transcript;
      processSpellingResult(transcript);
    });
    recognition.addEventListener("error", (event) => {
      spellingbeeFeedback.textContent = `Error: ${event.error}`;
      recognizing = false;
      startSpellBtn.disabled = false;
      stopSpellBtn.disabled = true;
    });
    recognition.addEventListener("end", () => {
      recognizing = false;
      startSpellBtn.disabled = false;
      stopSpellBtn.disabled = true;
      if (!spellingbeeFeedback.textContent.includes("Correct")) {
        spellingbeeFeedback.textContent += " (Recognition ended, try again)";
      }
    });
  }

  // On load
  window.addEventListener("load", () => {
    // Restore dark mode
    const dm = localStorage.getItem("spellrightpro-darkmode");
    setDarkMode(dm === "true");

    // Start in OET mode and load words
    currentMode = modeSelect.value;
    oetInputContainer.classList.toggle("hidden", currentMode !== "oet");
    spellingbeeControls.classList.toggle("hidden", currentMode !== "spellingbee");
    loadWords();
  });
})();
</script>

</body>
</html>
