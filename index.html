<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spell Right Pro</title>
  <style>
    /* [Previous CSS content remains exactly the same] */
  </style>
</head>
<body>
  <!-- [Previous HTML content remains exactly the same until the script section] -->
  
  <script>
    // Initialize with empty word list
    let oetWordList = []; // Fallback in case oet_word_list.js doesn't load
    
    // Main application object
    const SpellRightApp = {
      // App Variables
      words: [],
      userEmail: "",
      currentAccent: "en-GB",
      currentWordIndex: 0,
      correctCount: 0,
      flaggedWords: [],
      incorrectWords: [],
      previousWords: [],
      mode: "",
      spellingBeeCorrectCount: 0,
      spellingBeeIncorrectWords: [],
      storageKey: "spellrightpro-progress",
      
      // Initialize the app
      init: function() {
        // Dark Mode Toggle
        const toggleButton = document.getElementById("modeToggle");
        toggleButton.addEventListener("click", () => {
          document.body.classList.toggle("dark-mode");
        });
        
        // Initialize other event listeners
        document.getElementById("userEmail").addEventListener("keypress", (e) => {
          if (e.key === "Enter") this.loginUser();
        });
        
        // Try to load OET words (fallback to empty array)
        try {
          if (typeof oetWordList !== 'undefined' && oetWordList.length) {
            console.log("OET words loaded successfully");
          } else {
            oetWordList = ["sample", "words", "if", "loading", "failed"];
            console.warn("Using fallback word list");
          }
        } catch (e) {
          oetWordList = ["sample", "words", "if", "loading", "failed"];
          console.error("Word list loading error:", e);
        }
      },
      
      // [All other functions remain the same but need to be modified to use 'this' instead of global variables]
      // For example:
      loginUser: function() {
        this.userEmail = document.getElementById("userEmail").value.trim();
        document.getElementById("loginStatus").textContent = this.userEmail
          ? `Logged in as ${this.userEmail}`
          : "";
      },
      
      selectExamWords: function() {
        const selectedExam = document.getElementById("examSelect").value;
        if (selectedExam === "OET") {
          this.words = [...oetWordList];
          alert("OET word list loaded. Please start a mode.");
        } else if (selectedExam === "SpellingBee") {
          this.words = ["example", "banana", "language", "computer", "apple"];
          alert("Spelling Bee sample list loaded. Starting Spelling Bee mode...");
          this.startSpellingBee();
        } else {
          this.words = [];
          document.getElementById("trainer").innerHTML =
            "<p>No words loaded. Please select an exam or add custom words.</p>";
        }
      },
      
      // [Include all other functions here, converting them to methods]
      // Example:
      startPractice: function() {
        if (this.words.length === 0) {
          alert("Please select an exam or load words first.");
          return;
        }
        this.mode = "practice";
        this.loadProgress();
        this.presentWord();
      }
      
      // [Continue with all other functions...]
    };

    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      SpellRightApp.init();
      
      // Make app functions available globally (for HTML onclick handlers)
      window.loginUser = () => SpellRightApp.loginUser();
      window.changeAccent = () => SpellRightApp.changeAccent();
      window.selectExamWords = () => SpellRightApp.selectExamWords();
      window.startPractice = () => SpellRightApp.startPractice();
      window.startTest = () => SpellRightApp.startTest();
      window.addCustomWords = () => SpellRightApp.addCustomWords();
      window.handleFileUpload = (e) => SpellRightApp.handleFileUpload(e);
      window.saveWordList = () => SpellRightApp.saveWordList();
      window.loadWordList = () => SpellRightApp.loadWordList();
      window.clearWordList = () => SpellRightApp.clearWordList();
    });

    // PDF.js initialization
    window.pdfjsLib = {
      GlobalWorkerOptions: {}
    };
  </script>
  
  <!-- Load external scripts at the end -->
  <script src="oet_word_list.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.0/mammoth.browser.min.js"></script>
</body>
</html>
