<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Spell Right Pro</title>
  <link rel="icon" href="logo.png" />
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f0f4f8;
      margin: 0;
    }
    h1 {
      text-align: center;
    }
    .controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .word-box {
      margin-bottom: 20px;
      padding: 15px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .flagged {
      background-color: #fff3cd !important;
    }
    .review-section {
      margin-top: 20px;
      padding: 15px;
      background: #f8d7da;
      border-radius: 10px;
    }
    .review-item {
      margin: 5px 0;
    }
    select, input[type="text"], input[type="email"], textarea {
      padding: 8px;
      font-size: 16px;
      margin: 5px;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }
    button {
      padding: 8px 12px;
      cursor: pointer;
      margin: 5px;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Spell Right Pro</h1>

  <div>
    <label>Accent:
      <select id="accentSelect" onchange="changeAccent()">
        <option value="en-GB">British</option>
        <option value="en-US">American</option>
        <option value="en-CA">Canadian</option>
        <option value="en-AU">Australian</option>
      </select>
    </label>

    <label>Select Exam:
      <select id="examSelect" onchange="loadExamWords()">
        <option value="">-- None --</option>
        <option value="OET">OET</option>
        <option value="IELTS">IELTS</option>
        <option value="TOEFL">TOEFL</option>
      </select>
    </label>

    <button onclick="startPractice()">?? Practice Mode</button>
    <button onclick="startTest()">?? Test Yourself (24 Words)</button>
  </div>

  <div id="trainer"></div>
  <div id="scoreDisplay" style="font-weight:bold; margin-top: 20px;"></div>

  <!-- Embedded Contact Form -->
  <section id="contact" style="margin-top: 60px; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 600px; margin-left: auto; margin-right: auto;">
    <h2>Contact Us</h2>
    <form name="contact" method="POST" data-netlify="true" netlify-honeypot="bot-field" onsubmit="return submitForm(event)">
      <input type="hidden" name="form-name" value="contact" />
      <p class="hidden">
        <label>Don’t fill this out if you're human: <input name="bot-field" /></label>
      </p>

      <label>Your Name: <input type="text" name="name" required></label>
      <label>Your Email: <input type="email" name="email" required></label>
      <label>Message: <textarea name="message" rows="5" required></textarea></label>
      <button type="submit" style="background-color: #007bff; color: white; border: none; border-radius: 4px;">Send Message</button>
    </form>
  </section>

  <script>
    const oetWordList = [
      "Nausea", "Diabetes", "Scarlet fever", "Cirrhosis", "Injection",
      "Hearing loss", "Swallow", "Pneumonia", "Constipation", "Booster injection"
    ];
    const examWordLists = {
      OET: oetWordList,
      IELTS: ["confidence", "resilience", "education"],
      TOEFL: ["academic", "theory", "research"]
    };

    let words = [], currentAccent = 'en-GB', currentWordIndex = 0, correctCount = 0;
    let flaggedWords = [], incorrectWords = [], previousWords = [], mode = "";

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = currentAccent;
      speechSynthesis.speak(utterance);
    }

    function changeAccent() {
      currentAccent = document.getElementById("accentSelect").value;
    }

    function loadExamWords() {
      const exam = document.getElementById("examSelect").value;
      if (exam && examWordLists[exam]) {
        words = [...examWordLists[exam]];
        startPractice();
      }
    }

    function startPractice() {
      words = [...oetWordList];
      currentWordIndex = 0;
      correctCount = 0;
      flaggedWords = [];
      incorrectWords = [];
      previousWords = [];
      mode = "practice";
      presentWord();
    }

    function startTest() {
      words = shuffle([...oetWordList]).slice(0, 24);
      currentWordIndex = 0;
      correctCount = 0;
      flaggedWords = [];
      incorrectWords = [];
      previousWords = [];
      mode = "test";
      presentWord();
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function presentWord() {
      const trainerDiv = document.getElementById("trainer");
      trainerDiv.innerHTML = '';
      const word = words[currentWordIndex];

      const box = document.createElement("div");
      box.className = "word-box";
      if (flaggedWords.includes(currentWordIndex)) box.classList.add("flagged");

      const title = document.createElement("div");
      title.innerHTML = `<strong>Word ${currentWordIndex + 1} of ${words.length}</strong>`;

      const speakBtn = document.createElement("button");
      speakBtn.textContent = "?? Speak";
      speakBtn.onclick = () => speak(word);

      const input = document.createElement("input");
      input.type = "text";
      input.placeholder = "Type what you heard...";
      input.addEventListener("keypress", function(e) {
        if (e.key === "Enter") checkAnswer();
      });

      const checkBtn = document.createElement("button");
      checkBtn.textContent = "?? Check";

      const flagBtn = document.createElement("button");
      flagBtn.textContent = flaggedWords.includes(currentWordIndex) ? "?? Unflag" : "?? Flag";
      flagBtn.onclick = () => {
        const idx = flaggedWords.indexOf(currentWordIndex);
        if (idx === -1) {
          flaggedWords.push(currentWordIndex);
          flagBtn.textContent = "?? Unflag";
          box.classList.add("flagged");
        } else {
          flaggedWords.splice(idx, 1);
          flagBtn.textContent = "?? Flag";
          box.classList.remove("flagged");
        }
      };

      const backBtn = document.createElement("button");
      backBtn.textContent = "?? Back";
      backBtn.disabled = previousWords.length === 0;
      backBtn.onclick = () => {
        if (previousWords.length > 0) {
          currentWordIndex = previousWords.pop();
          presentWord();
        }
      };

      const status = document.createElement("span");
      status.className = "status";

      checkBtn.onclick = function checkAnswer() {
        const typed = input.value.trim().toLowerCase();
        const expected = word.toLowerCase();
        previousWords.push(currentWordIndex);

        if (typed === expected) {
          status.textContent = "? Correct";
          status.style.color = "green";
          correctCount++;
        } else {
          status.textContent = `? Wrong. Correct: ${word}`;
          status.style.color = "red";
          incorrectWords.push({ word, typed });
        }

        setTimeout(() => {
          currentWordIndex++;
          if (currentWordIndex < words.length) {
            presentWord();
          } else {
            showScore();
          }
        }, 1500);
      };

      box.appendChild(title);
      box.appendChild(speakBtn);
      box.appendChild(document.createElement("br"));
      box.appendChild(input);
      box.appendChild(checkBtn);
      box.appendChild(flagBtn);
      box.appendChild(backBtn);
      box.appendChild(status);
      trainerDiv.appendChild(box);
      speak(word);
    }

    function showScore() {
      const scoreDisplay = document.getElementById("scoreDisplay");
      scoreDisplay.innerHTML = `You got ${correctCount} out of ${words.length} correct. (${Math.round(correctCount / words.length * 100)}%)`;

      if (incorrectWords.length > 0) {
        incorrectWords.forEach(item => {
          const div = document.createElement("div");
          div.textContent = `? You wrote "${item.typed}" instead of "${item.word}"`;
          scoreDisplay.appendChild(div);
        });
      }

      if (flaggedWords.length > 0) {
        scoreDisplay.innerHTML += `<h4>Flagged Words:</h4>`;
        flaggedWords.forEach(idx => {
          const div = document.createElement("div");
          div.textContent = `?? ${words[idx]}`;
          scoreDisplay.appendChild(div);
        });
      }
    }

    function submitForm(e) {
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);

      fetch("/", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams(data).toString(),
      })
      .then(() => window.location.href = "index.html")
      .catch((error) => alert("Form submission failed. Please try again."));
    }
  </script>
</body>
</html>